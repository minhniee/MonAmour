@model MonAmour.AuthViewModel.CreateReviewViewModel
@{
    ViewData["Title"] = "Tạo Đánh Giá";
    Layout = "_Layout";
}

<div class="min-h-screen bg-beige">
    <div class="max-w-2xl mx-auto px-4 py-8">
        <div class="mb-6">
            <nav aria-label="breadcrumb">
                <ol class="flex items-center space-x-2 text-sm text-gray-600">
                    <li><a href="@Url.Action("Index", new { targetType = Model.TargetType, targetId = Model.TargetId })" class="hover:text-wine-red">Danh Sách Đánh Giá</a></li>
                    <li class="before:content-['/'] before:mx-2">Tạo Đánh Giá</li>
                </ol>
            </nav>
            <h1 class="text-3xl font-serif font-bold text-wine-red mt-4">Tạo Đánh Giá Mới</h1>
        </div>

        <div class="bg-white rounded-lg shadow-sm border p-6">
            <form asp-action="Create" method="post">
                @Html.AntiForgeryToken()
                <input asp-for="UserId" type="hidden" />
                
                <div asp-validation-summary="ModelOnly" class="mb-4 p-4 bg-red-50 border border-red-200 rounded-md text-red-700" role="alert"></div>

                <div class="mb-6">
                    <label asp-for="TargetType" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tag text-wine-red mr-2"></i>Loại Đối Tượng
                    </label>
                    <select asp-for="TargetType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-wine-red focus:border-wine-red">
                        <option value="">-- Chọn loại đối tượng --</option>
                        <option value="Product">Sản Phẩm</option>
                        <option value="Concept">Ý Tưởng</option>
                    </select>
                    <span asp-validation-for="TargetType" class="text-sm text-red-600 mt-1 block"></span>
                </div>

                <div class="mb-6">
                    <label asp-for="TargetId" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-hashtag text-wine-red mr-2"></i>ID Đối Tượng
                    </label>
                    <input asp-for="TargetId" type="number" min="1" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-wine-red focus:border-wine-red" 
                           placeholder="Nhập ID của sản phẩm hoặc ý tưởng">
                    <span asp-validation-for="TargetId" class="text-sm text-red-600 mt-1 block"></span>
                    <p class="text-sm text-gray-500 mt-1">Nhập ID của sản phẩm hoặc ý tưởng bạn muốn đánh giá.</p>
                </div>

                <partial name="_ReviewFields" model="Model" />

                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <a href="@Url.Action("Index", new { targetType = Model.TargetType, targetId = Model.TargetId })" 
                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        <i class="fas fa-arrow-left mr-2"></i>Quay Lại
                    </a>
                    <button type="submit" class="px-6 py-2 text-sm font-medium text-white bg-wine-red border border-transparent rounded-md hover:bg-wine-red/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-wine-red">
                        <i class="fas fa-star mr-2"></i>Tạo Đánh Giá
                    </button>
                </div>
            </form>
        </div>

        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-md p-4">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-400"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">Hướng dẫn đánh giá</h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Đánh giá từ 1-5 sao dựa trên trải nghiệm của bạn</li>
                            <li>Chia sẻ ý kiến chân thật để giúp người khác</li>
                            <li>Tránh ngôn từ không phù hợp hoặc spam</li>
                            <li>Bạn chỉ có thể đánh giá một lần cho mỗi sản phẩm/ý tưởng</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentRating = @(Model.Rating);
    
    function setRating(rating) {
        currentRating = rating;
        document.getElementById('rating-input').value = rating;
        updateStarDisplay();
        updateRatingText();
    }
    
    function updateStarDisplay() {
        const stars = document.querySelectorAll('.star-button');
        stars.forEach((star, index) => {
            const starIcon = star.querySelector('i');
            if (index < currentRating) {
                starIcon.className = 'fas fa-star text-yellow-400';
            } else {
                starIcon.className = 'fas fa-star text-gray-300';
            }
        });
    }
    
    function updateRatingText() {
        const textElement = document.getElementById('rating-text');
        const ratingTexts = {
            1: '1 sao - Rất tệ',
            2: '2 sao - Tệ',
            3: '3 sao - Bình thường',
            4: '4 sao - Tốt',
            5: '5 sao - Rất tốt'
        };
        
        if (currentRating > 0) {
            textElement.textContent = ratingTexts[currentRating];
            textElement.className = 'text-sm text-wine-red ml-3 font-medium';
        } else {
            textElement.textContent = 'Chưa chọn';
            textElement.className = 'text-sm text-gray-600 ml-3';
        }
    }

    // Comment character counter
    function updateCommentCount() {
        const textarea = document.querySelector('textarea[name="Comment"]');
        const counter = document.getElementById('comment-count');
        const currentLength = textarea.value.length;
        counter.textContent = `${currentLength}/1000`;
        
        if (currentLength > 1000) {
            counter.className = 'text-sm text-red-500';
        } else if (currentLength > 900) {
            counter.className = 'text-sm text-yellow-600';
        } else {
            counter.className = 'text-sm text-gray-500';
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateStarDisplay();
        updateRatingText();
        
        const textarea = document.querySelector('textarea[name="Comment"]');
        textarea.addEventListener('input', updateCommentCount);
        updateCommentCount();

        // Add hover effects to stars
        const stars = document.querySelectorAll('.star-button');
        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', function() {
                const hoverRating = index + 1;
                stars.forEach((s, i) => {
                    const starIcon = s.querySelector('i');
                    if (i < hoverRating) {
                        starIcon.className = 'fas fa-star text-yellow-400';
                    } else {
                        starIcon.className = 'fas fa-star text-gray-300';
                    }
                });
            });
            
            star.addEventListener('mouseleave', function() {
                updateStarDisplay();
            });
        });
    });
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
