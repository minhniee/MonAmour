@{
    ViewData["Title"] = "Order History";
    Layout = "_Layout";
}

@using MonAmour.ViewModels
@model OrderHistoryUserViewModel

<div class="min-h-screen py-8" style="background-color: #fbf1e6;">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="text-center mb-8">
            <h1 class="font-prata text-4xl font-bold mb-4" style="color: #62000d;">
                Order History
            </h1>
            <p class="text-lg text-muted-foreground">Track your romantic experiences and gift deliveries</p>
        </div>

        <!-- Tabs Navigation -->
        <div class="w-full mb-8">
            <div class="grid grid-cols-3 bg-white border-2 rounded-lg" style="border-color: #fbf1e6;">
                <button class="tab-button px-4 py-3 text-center font-medium rounded-l-lg transition-all duration-200"
                        data-tab="all" style="color: #62000d;">
                    All Orders (<span id="all-count">@Model.Categories.SelectMany(c => c.Orders).Count()</span>)
                </button>
                <button class="tab-button px-4 py-3 text-center font-medium transition-all duration-200"
                        data-tab="concept" style="color: #62000d;">
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    Concepts (<span id="concept-count">@Model.Categories.FirstOrDefault(c => c.Name == "Concept")?.Orders.Count ?? 0</span>)
                </button>
                <button class="tab-button px-4 py-3 text-center font-medium rounded-r-lg transition-all duration-200"
                        data-tab="giftbox" style="color: #62000d;">
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                    </svg>
                    Gift Boxes (<span id="giftbox-count">@Model.Categories.FirstOrDefault(c => c.Name == "Gift Box")?.Orders.Count ?? 0</span>)
                </button>
            </div>
        </div>

        <!-- All Orders Tab -->
        <div id="tab-all" class="tab-content space-y-4">
            @{
                var allOrders = Model.Categories.SelectMany(c => c.Orders).ToList();
                var initialAllOrders = allOrders.Take(5);
                var remainingAllOrders = allOrders.Skip(5);
            }
            @if (allOrders.Any())
            {
                <div class="space-y-4" id="all-orders-container">
                    @foreach (var order in initialAllOrders)
                    {
                        <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                            <partial name="_OrderCard" model="order" />
                            <div class="px-5 pb-4 flex justify-end">
                                <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                   class="text-sm hover:underline" style="color: #62000d;">
                                    Xem chi tiết đơn hàng →
                                </a>
                            </div>
                        </div>
                    }
                </div>
                @if (remainingAllOrders.Any())
                {
                    <div class="hidden space-y-4" id="all-orders-remaining">
                        @foreach (var order in remainingAllOrders)
                        {
                            <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                                <partial name="_OrderCard" model="order" />
                                <div class="px-5 pb-4 flex justify-end">
                                    <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                       class="text-sm hover:underline" style="color: #62000d;">
                                        Xem chi tiết đơn hàng →
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="text-center mt-6" id="all-load-more">
                        <button type="button" onclick="loadMore('all')"
                                class="px-6 py-2 text-white rounded-lg transition-colors"
                                style="background-color: #62000d;">
                            Hiển thị thêm
                        </button>
                    </div>
                }
            }
            else
            {
                <div class="bg-white rounded-lg border-2 text-center py-12" style="border-color: #fbf1e6;">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    <h3 class="font-prata text-xl mb-2">No Orders Yet</h3>
                    <p class="text-gray-600">Start creating beautiful memories with our romantic experiences.</p>
                </div>
            }
        </div>

        <!-- Concept Orders Tab -->
        <div id="tab-concept" class="tab-content space-y-4 hidden">
            @{
                var conceptCategory = Model.Categories.FirstOrDefault(c => c.Name == "Concept");
                var conceptOrders = conceptCategory?.Orders ?? new List<OrderSummaryUserViewModel>();
                var initialConceptOrders = conceptOrders.Take(5);
                var remainingConceptOrders = conceptOrders.Skip(5);
            }
            @if (conceptOrders.Any())
            {
                <div class="space-y-4" id="concept-orders-container">
                    @foreach (var order in initialConceptOrders)
                    {
                        <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                            <partial name="_OrderCard" model="order" />
                            <div class="px-5 pb-4 flex justify-end">
                                <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                   class="text-sm hover:underline" style="color: #62000d;">
                                    Xem chi tiết đơn hàng →
                                </a>
                            </div>
                        </div>
                    }
                </div>
                @if (remainingConceptOrders.Any())
                {
                    <div class="hidden space-y-4" id="concept-orders-remaining">
                        @foreach (var order in remainingConceptOrders)
                        {
                            <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                                <partial name="_OrderCard" model="order" />
                                <div class="px-5 pb-4 flex justify-end">
                                    <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                       class="text-sm hover:underline" style="color: #62000d;">
                                        Xem chi tiết đơn hàng →
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="text-center mt-6" id="concept-load-more">
                        <button type="button" onclick="loadMore('concept')"
                                class="px-6 py-2 text-white rounded-lg transition-colors"
                                style="background-color: #62000d;">
                            Hiển thị thêm
                        </button>
                    </div>
                }
            }
            else
            {
                <div class="bg-white rounded-lg border-2 text-center py-12" style="border-color: #fbf1e6;">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    <h3 class="font-prata text-xl mb-2">No Concept Orders</h3>
                    <p class="text-gray-600">Explore our romantic experience concepts.</p>
                </div>
            }
        </div>

        <!-- Gift Box Orders Tab -->
        <div id="tab-giftbox" class="tab-content space-y-4 hidden">
            @{
                var giftBoxCategory = Model.Categories.FirstOrDefault(c => c.Name == "Gift Box");
                var giftBoxOrders = giftBoxCategory?.Orders ?? new List<OrderSummaryUserViewModel>();
                var initialGiftBoxOrders = giftBoxOrders.Take(5);
                var remainingGiftBoxOrders = giftBoxOrders.Skip(5);
            }
            @if (giftBoxOrders.Any())
            {
                <div class="space-y-4" id="giftbox-orders-container">
                    @foreach (var order in initialGiftBoxOrders)
                    {
                        <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                            <partial name="_OrderCard" model="order" />
                            <div class="px-5 pb-4 flex justify-end">
                                <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                   class="text-sm hover:underline" style="color: #62000d;">
                                    Xem chi tiết đơn hàng →
                                </a>
                            </div>
                        </div>
                    }
                </div>
                @if (remainingGiftBoxOrders.Any())
                {
                    <div class="hidden space-y-4" id="giftbox-orders-remaining">
                        @foreach (var order in remainingGiftBoxOrders)
                        {
                            <div class="bg-white rounded-lg border-2" style="border-color: #fbf1e6;">
                                <partial name="_OrderCard" model="order" />
                                <div class="px-5 pb-4 flex justify-end">
                                    <a href="@Url.Action("OrderDetail", "Profile", new { orderNumber = order.OrderNumber })" 
                                       class="text-sm hover:underline" style="color: #62000d;">
                                        Xem chi tiết đơn hàng →
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="text-center mt-6" id="giftbox-load-more">
                        <button type="button" onclick="loadMore('giftbox')"
                                class="px-6 py-2 text-white rounded-lg transition-colors"
                                style="background-color: #62000d;">
                            Hiển thị thêm
                        </button>
                    </div>
                }
            }
            else
            {
                <div class="bg-white rounded-lg border-2 text-center py-12" style="border-color: #fbf1e6;">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                    </svg>
                    <h3 class="font-prata text-xl mb-2">No Gift Box Orders</h3>
                    <p class="text-gray-600">Browse our curated gift box collection.</p>
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');

                // Remove active class from all buttons
                tabButtons.forEach(btn => {
                    btn.style.backgroundColor = 'transparent';
                    btn.style.color = '#62000d';
                });

                // Add active class to clicked button
                this.style.backgroundColor = '#62000d';
                this.style.color = 'white';

                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });

                // Show selected tab content
                document.getElementById('tab-' + tabName).classList.remove('hidden');
            });
        });

        // Set initial active tab
        document.querySelector('[data-tab="all"]').click();
    });

    function loadMore(type) {
        const container = document.getElementById(`${type}-orders-container`);
        const remaining = document.getElementById(`${type}-orders-remaining`);
        const loadMoreBtn = document.getElementById(`${type}-load-more`);
        
        // Move remaining orders to main container
        const orders = remaining.children;
        while (orders.length > 0) {
            container.appendChild(orders[0]);
        }
        
        // Hide the load more button and remaining container
        loadMoreBtn.style.display = 'none';
        remaining.remove();
    }
</script>