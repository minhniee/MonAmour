@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <div>
        <h1>Dashboard</h1>
        <p class="subtitle">Free Bootstrap 5 Admin Dashboard</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-outline-primary">Manage</button>
        <button class="btn btn-primary">Add Customer</button>
    </div>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card visitors">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>@(ViewBag.UserStats?.ContainsKey("TotalUsers") == true ? ViewBag.UserStats["TotalUsers"] : 0)</h3>
            <p>Tổng người dùng</p>
        </div>
    </div>

    <div class="stat-card subscribers">
        <div class="stat-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-content">
            <h3>@(ViewBag.UserStats?.ContainsKey("VerifiedUsers") == true ? ViewBag.UserStats["VerifiedUsers"] : 0)</h3>
            <p>Đã xác thực</p>
        </div>
    </div>

    <div class="stat-card sales">
        <div class="stat-icon">
            <i class="fas fa-user-shield"></i>
        </div>
        <div class="stat-content">
            <h3>@(ViewBag.UserStats?.ContainsKey("AdminUsers") == true ? ViewBag.UserStats["AdminUsers"] : 0)</h3>
            <p>Quản trị viên</p>
        </div>
    </div>

    <div class="stat-card orders">
        <div class="stat-icon">
            <i class="fas fa-user-clock"></i>
        </div>
        <div class="stat-content">
            <h3>@(ViewBag.UserStats?.ContainsKey("ActiveUsers") == true ? ViewBag.UserStats["ActiveUsers"] : 0)</h3>
            <p>Đang hoạt động</p>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-section">
    <div class="chart-card user-statistics">
        <div class="chart-header">
            <h4>Thống kê người dùng</h4>
        </div>
        <div class="chart-content">
            <canvas id="userStatsChart" width="400" height="200"></canvas>
        </div>
    </div>

    <div class="chart-card daily-sales">
        <div class="chart-header">
            <h4>Hoạt động gần đây</h4>
            <div class="chart-actions">
                <span class="date-range">Tuần này</span>
                <button class="btn btn-sm btn-outline-light">
                    Export <i class="fas fa-chevron-down"></i>
                </button>
            </div>
        </div>
        <div class="chart-content">
            <div class="sales-amount">@(ViewBag.UserStats?.ContainsKey("TotalUsers") == true ? ViewBag.UserStats["TotalUsers"] : 0) người dùng</div>
            <div class="sales-chart">
                <canvas id="salesChart" width="300" height="100"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Section -->
<div class="bottom-section">
    <div class="users-online-card">
        <div class="card-content">
            <h3>@(ViewBag.UserStats?.ContainsKey("VerifiedUsers") == true ? ViewBag.UserStats["VerifiedUsers"] : 0)</h3>
            <p>Đã xác thực</p>
            <span class="trend positive">+@(ViewBag.UserStats?.ContainsKey("VerifiedUsers") == true ? Math.Round((double)ViewBag.UserStats["VerifiedUsers"] / Math.Max(ViewBag.UserStats["TotalUsers"], 1) * 100, 1) : 0)%</span>
        </div>
        <div class="mini-chart">
            <canvas id="onlineChart" width="100" height="30"></canvas>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Chart !== 'undefined') {
                initializeDashboardCharts();
            }
        });

        function initializeDashboardCharts() {
            // User Statistics Chart with real data
            const userStatsCtx = document.getElementById('userStatsChart');
            if (userStatsCtx) {
                const totalUsers = @(ViewBag.UserStats?.ContainsKey("TotalUsers") == true ? ViewBag.UserStats["TotalUsers"] : 0);
                const verifiedUsers = @(ViewBag.UserStats?.ContainsKey("VerifiedUsers") == true ? ViewBag.UserStats["VerifiedUsers"] : 0);
                const adminUsers = @(ViewBag.UserStats?.ContainsKey("AdminUsers") == true ? ViewBag.UserStats["AdminUsers"] : 0);
                const activeUsers = @(ViewBag.UserStats?.ContainsKey("ActiveUsers") == true ? ViewBag.UserStats["ActiveUsers"] : 0);

                new Chart(userStatsCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                        datasets: [{
                            label: 'Tổng người dùng',
                            data: [totalUsers * 0.1, totalUsers * 0.2, totalUsers * 0.3, totalUsers * 0.4, totalUsers * 0.5, totalUsers * 0.6, totalUsers * 0.7, totalUsers * 0.8, totalUsers * 0.9, totalUsers * 0.95, totalUsers * 0.98, totalUsers],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true
                        }, {
                            label: 'Đã xác thực',
                            data: [verifiedUsers * 0.1, verifiedUsers * 0.2, verifiedUsers * 0.3, verifiedUsers * 0.4, verifiedUsers * 0.5, verifiedUsers * 0.6, verifiedUsers * 0.7, verifiedUsers * 0.8, verifiedUsers * 0.9, verifiedUsers * 0.95, verifiedUsers * 0.98, verifiedUsers],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true
                        }, {
                            label: 'Quản trị viên',
                            data: [adminUsers * 0.1, adminUsers * 0.2, adminUsers * 0.3, adminUsers * 0.4, adminUsers * 0.5, adminUsers * 0.6, adminUsers * 0.7, adminUsers * 0.8, adminUsers * 0.9, adminUsers * 0.95, adminUsers * 0.98, adminUsers],
                            borderColor: '#6f42c1',
                            backgroundColor: 'rgba(111, 66, 193, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Sales Chart (Activity Chart)
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                const totalUsers = @(ViewBag.UserStats?.ContainsKey("TotalUsers") == true ? ViewBag.UserStats["TotalUsers"] : 0);
                new Chart(salesCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
                        datasets: [{
                            label: 'Hoạt động',
                            data: [totalUsers * 0.1, totalUsers * 0.15, totalUsers * 0.2, totalUsers * 0.25, totalUsers * 0.3, totalUsers * 0.35, totalUsers * 0.4],
                            borderColor: 'rgba(255, 255, 255, 0.8)',
                            backgroundColor: 'rgba(255, 255, 255, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                display: false
                            },
                            y: {
                                display: false
                            }
                        },
                        elements: {
                            point: {
                                radius: 0
                            }
                        }
                    }
                });
            }

            // Online Users Chart
            const onlineCtx = document.getElementById('onlineChart');
            if (onlineCtx) {
                const verifiedUsers = @(ViewBag.UserStats?.ContainsKey("VerifiedUsers") == true ? ViewBag.UserStats["VerifiedUsers"] : 0);
                new Chart(onlineCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['', '', '', '', '', '', ''],
                        datasets: [{
                            label: 'Đã xác thực',
                            data: [verifiedUsers * 0.1, verifiedUsers * 0.2, verifiedUsers * 0.3, verifiedUsers * 0.4, verifiedUsers * 0.5, verifiedUsers * 0.6, verifiedUsers * 0.7],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                display: false
                            },
                            y: {
                                display: false
                            }
                        },
                        elements: {
                            point: {
                                radius: 0
                            }
                        }
                    }
                });
            }
        }
    </script>
}
