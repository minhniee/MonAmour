@model MonAmour.Models.Concept
@{
	ViewData["Title"] = Model.Name + " - MonAmour";
	var relatedConcepts = ViewBag.RelatedConcepts as List<MonAmour.Models.Concept>;
	var primaryImage = Model.ConceptImgs?.FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? Model.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=800&h=600&fit=crop";
	var coverImages = Model.ConceptImgs?.Where(img => img.DisplayOrder == 2 || img.DisplayOrder == 3).OrderBy(img => img.DisplayOrder).ToList() ?? new List<MonAmour.Models.ConceptImg>();
	var detailImages = Model.ConceptImgs?.Where(img => img.DisplayOrder >= 4 && img.DisplayOrder <= 6).OrderBy(img => img.DisplayOrder).ToList() ?? new List<MonAmour.Models.ConceptImg>();
}

<div class="min-h-screen bg-beige">

	<!-- Cover Images (Display Order 2,3) -->
	<section class="py-8">
		<div class="container mx-auto px-4">
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				@if (coverImages.Count > 0)
				{
					<div class="relative cursor-pointer" onclick="openLightbox('@coverImages[0].ImgUrl', '@Model.Name')">
						<img src="@coverImages[0].ImgUrl" alt="@Model.Name" class="w-full h-96 object-cover rounded-2xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
						<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
							<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
							</svg>
						</div>
					</div>
				}
				@if (coverImages.Count > 1)
				{
					<div class="relative cursor-pointer" onclick="openLightbox('@coverImages[1].ImgUrl', '@Model.Name')">
						<img src="@coverImages[1].ImgUrl" alt="@Model.Name" class="w-full h-96 object-cover rounded-2xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
						<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
							<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
							</svg>
						</div>
					</div>
				}
			</div>
		</div>
	</section>

	<!-- Primary Image Section -->
	<section class="py-12">
		<div class="container mx-auto px-4 text-center">
			<h2 class="font-prata text-4xl md:text-5xl text-wine-red mb-6">@Model.Name</h2>
			<div class="w-full max-w-4xl mx-auto">
				<div class="relative cursor-pointer" onclick="openLightbox('@primaryImage', '@Model.Name')">
					<img src="@primaryImage" alt="@Model.Name" class="w-full h-64 md:h-80 object-cover rounded-2xl shadow-lg mb-6 hover:shadow-2xl transition-shadow duration-300">
					<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
						<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
						</svg>
					</div>
				</div>
				@if (!string.IsNullOrEmpty(Model.Description))
				{
					<p class="font-noto-serif text-lg text-gray-700 max-w-3xl mx-auto">@Model.Description</p>
				}
			</div>
		</div>
	</section>

	<!-- Detail Images Section (Display Order 4,5,6) -->
	@if (detailImages.Any())
	{
		<section class="py-12 bg-white/50">
			<div class="container mx-auto px-4">
				<!-- Ảnh 4 và 5 theo thiết kế -->
				@if (detailImages.Count >= 2)
				{
					<!-- Ảnh 4 với mô tả bên phải -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-12">
						<div class="relative cursor-pointer" onclick="openLightbox('@detailImages[0].ImgUrl', '@detailImages[0].AltText')">
							<img src="@detailImages[0].ImgUrl" alt="@detailImages[0].AltText" class="w-full h-80 object-cover rounded-2xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
							<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
								<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
								</svg>
							</div>
						</div>
						<div>
							<h3 class="font-prata text-3xl text-wine-red mb-4">Các điểm nổi bật của concept</h3>
							@if (!string.IsNullOrEmpty(detailImages[0].AltText))
							{
								<p class="font-noto-serif text-lg text-gray-700">@detailImages[0].AltText</p>
							}
						</div>
					</div>
					
					<!-- Ảnh 5 với mô tả bên trái -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-12">
						<div class="order-2 md:order-1">
							<h3 class="font-prata text-3xl text-wine-red mb-4">Các điểm nổi bật của concept</h3>
							@if (!string.IsNullOrEmpty(detailImages[1].AltText))
							{
								<p class="font-noto-serif text-lg text-gray-700">@detailImages[1].AltText</p>
							}
						</div>
						<div class="order-1 md:order-2 relative cursor-pointer" onclick="openLightbox('@detailImages[1].ImgUrl', '@detailImages[1].AltText')">
							<img src="@detailImages[1].ImgUrl" alt="@detailImages[1].AltText" class="w-full h-80 object-cover rounded-2xl shadow-lg hover:shadow-2xl transition-shadow duration-300">
							<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
								<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
								</svg>
							</div>
						</div>
					</div>
				}
				
				<!-- Ảnh 6 xếp toàn bộ chiều rộng như ảnh primary -->
				@if (detailImages.Count >= 3)
				{
					<div class="text-center">
						<h3 class="font-prata text-3xl text-wine-red mb-6">Chi tiết về concept</h3>
						<div class="relative cursor-pointer inline-block" onclick="openLightbox('@detailImages[2].ImgUrl', '@detailImages[2].AltText')">
							<img src="@detailImages[2].ImgUrl" alt="@detailImages[2].AltText" class="w-full h-64 md:h-80 object-cover rounded-2xl shadow-lg mb-4 hover:shadow-2xl transition-shadow duration-300">
							<div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 rounded-2xl flex items-center justify-center">
								<svg class="w-12 h-12 text-white opacity-0 hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
								</svg>
							</div>
						</div>
						@if (!string.IsNullOrEmpty(detailImages[2].AltText))
						{
							<p class="font-noto-serif text-gray-700 text-sm">@detailImages[2].AltText</p>
						}
					</div>
				}
			</div>
		</section>
	}

	<!-- Main Color Palette Section -->
	<section class="py-12">
		<div class="container mx-auto px-4 text-center">
			<h3 class="font-prata text-3xl text-wine-red mb-4">Tông màu chủ đạo</h3>
			<p class="font-noto-serif text-lg text-gray-700 mb-8 max-w-2xl mx-auto">Mô tả về tông màu và phong cách thiết kế</p>
			@{
				var palette = Model.ConceptColorJunctions?
					.Select(j => j.Color)
					.Where(c => c != null && !string.IsNullOrWhiteSpace(c.Code))
					.ToList();
			}
			@if (palette != null && palette.Any())
			{
				<div class="flex justify-center space-x-4">
					@foreach (var color in palette)
					{
						<div class="w-16 h-16 rounded-full shadow-lg border-2 border-wine-red" style="background-color: @color.Code"></div>
					}
				</div>
			}
			else
			{
				<div class="flex justify-center space-x-4">
					<div class="w-16 h-16 rounded-full bg-wine-red shadow-lg"></div>
					<div class="w-16 h-16 rounded-full bg-beige border-2 border-wine-red shadow-lg"></div>
					<div class="w-16 h-16 rounded-full bg-gray-300 shadow-lg"></div>
					<div class="w-16 h-16 rounded-full bg-gray-600 shadow-lg"></div>
				</div>
			}
		</div>
	</section>

	<!-- Booking Section -->
	<section class="py-12">
		<div class="container mx-auto px-4 text-center">
			<h3 class="font-prata text-3xl text-wine-red mb-8">Đặt Lịch</h3>
			<div class="max-w-md mx-auto bg-white border border-wine-red/20 rounded-2xl p-8 shadow-lg">
				
					<form id="bookingForm">
				<div class="grid grid-cols-2 gap-4 mb-6">
					<div>
						<label class="block text-wine-red font-prata text-sm mb-2">Ngày</label>
						<input type="date" id="bookingDate" name="bookingDate" required 
							   class="w-full px-4 py-3 border border-wine-red/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-wine-red/50 font-noto-serif"
							   min="@DateTime.Now.ToString("yyyy-MM-dd")">
					</div>
					<div>
						<label class="block text-wine-red font-prata text-sm mb-2">Giờ</label>
						<div class="relative">
							<input type="text" id="bookingTime" name="bookingTime" required 
							   class="w-full px-4 py-3 border border-wine-red/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-wine-red/50 font-noto-serif"
							   placeholder="--:--" readonly onclick="showTimePicker()" onfocus="showTimePicker()">
							<div id="customTimePicker" class="hidden absolute left-0 right-0 mt-2 bg-white border border-wine-red/20 rounded-xl shadow-2xl w-full z-50">
								<div class="timepicker grid grid-rows-[auto_1fr]">
									<div class="grid grid-cols-2 text-center text-wine-red/80 font-prata text-sm border-b border-wine-red/10">
										<div class="py-2">Giờ</div>
										<div class="py-2">Phút</div>
									</div>
									<div class="grid grid-cols-2 divide-x divide-wine-red/10">
										<div id="hoursColumn" class="max-h-56 overflow-auto"></div>
										<div id="minutesColumn" class="max-h-56 overflow-auto"></div>
									</div>
								</div>
							</div>
						</div>
						<p class="text-xs text-gray-500 mt-1">Chọn giờ từ 8:00 - 22:00 (bước 30 phút)</p>
					</div>
				</div>
				<div class="mb-6">
					<div class="flex justify-between items-center p-4 bg-beige/50 rounded-lg">
						<span class="font-prata text-lg text-wine-red">Tổng cộng:</span>
						<span class="font-prata text-2xl font-bold text-wine-red">@String.Format("{0:N0}₫", Model.Price)</span>
					</div>
				</div>
				@if (ViewBag.IsLoggedIn)
				{

					<button type="submit" id="bookNowBtn"
					        class="w-full bg-wine-red text-beige py-4 rounded-lg font-prata text-lg hover:bg-wine-red/90 transition-colors duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
						<span id="btnText">Đặt ngay</span>
						<span id="btnLoading" class="hidden">
							<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
								<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
								<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
							</svg>
							Đang xử lý...
						</span>
						</button>
					}
					else
					{
						<a href="@Url.Action("Login","Auth")"
						   id="bookNowBtn"
						   class="w-full block text-center bg-wine-red text-beige py-4 rounded-lg font-prata text-lg hover:bg-wine-red/90 transition-colors duration-200 shadow-lg hover:shadow-xl">
							<span id="btnText">Đặt ngay</span>
						</a>
					}
				</form>
				
			</div>
		</div>
	</section>

	<!-- Related Concepts -->
	@if (relatedConcepts != null && relatedConcepts.Any())
	{
		<section class="py-12 bg-white/50">
			<div class="container mx-auto px-4">
				<h3 class="font-prata text-3xl text-wine-red text-center mb-8">Gói dịch vụ liên quan</h3>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
					@foreach (var related in relatedConcepts)
					{
						var relatedImg = related.ConceptImgs?.FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? related.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400&h=300&fit=crop";
						<a href="@Url.Action("ConceptDetail", "Concept", new { id = related.ConceptId })" class="group">
							<div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
								<div class="relative overflow-hidden cursor-pointer" onclick="openLightbox('@relatedImg', '@related.Name')">
									<img src="@relatedImg" alt="@related.Name" class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300">
									<div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
										<svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
										</svg>
									</div>
								</div>
								<div class="p-6">
									<h4 class="font-prata text-xl font-bold text-wine-red mb-2">@related.Name</h4>
									<p class="font-noto-serif text-gray-600 mb-4 line-clamp-2">@(related.Description?.Length > 100 ? related.Description.Substring(0, 100) + "..." : related.Description)</p>
									<div class="flex items-center justify-between">
										<span class="font-prata text-2xl font-bold text-wine-red">@String.Format("{0:N0}₫", related.Price)</span>
										<span class="text-sm text-gray-600">@related.Category?.Name</span>
									</div>
								</div>
							</div>
						</a>
					}
				</div>
			</div>
		</section>
	}
</div>

<!-- Lightbox Modal -->
<div id="lightbox" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center p-4">
	<div class="relative max-w-7xl max-h-full">
		<!-- Close Button -->
		<button onclick="closeLightbox()" class="absolute top-4 right-4 z-10 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-full p-2 transition-all duration-200">
			<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
			</svg>
		</button>
		
		<!-- Image -->
		<img id="lightboxImage" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg">
		
		<!-- Image Info -->
		<div id="lightboxInfo" class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-4 rounded-lg">
			<h3 id="lightboxTitle" class="font-prata text-xl mb-2"></h3>
		</div>
	</div>
</div>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	
	/* Lightbox animations */
	#lightbox {
		backdrop-filter: blur(5px);
	}
	
	#lightbox.show {
		animation: fadeIn 0.3s ease-out;
	}
	
	#lightbox.hide {
		animation: fadeOut 0.3s ease-out;
	}
	
	@@keyframes fadeIn {
		from { opacity: 0; }
		to { opacity: 1; }
	}
	
	@@keyframes fadeOut {
		from { opacity: 1; }
		to { opacity: 0; }
	}

	.timepicker button { transition: background-color .15s ease, color .15s ease; }
	.timepicker button:hover { background-color: rgba(127, 29, 29, 0.08); }
	.timepicker button.active { background-color: rgba(127, 29, 29, 0.12); color: #7f1d1d; font-weight: 600; }
</style>

<script>
	function showTimePicker() {
		const picker = document.getElementById('customTimePicker');
		const hoursCol = document.getElementById('hoursColumn');
		const minutesCol = document.getElementById('minutesColumn');
		const input = document.getElementById('bookingTime');

		if (!hoursCol.dataset.initialized) {
			// Populate hours 08 - 22
			let hoursHtml = '';
			for (let h = 8; h <= 22; h++) {
				const hh = h.toString().padStart(2, '0');
				hoursHtml += `<button type="button" data-hour="${hh}" class="block w-full text-left px-4 py-2">${hh}</button>`;
			}
			hoursCol.innerHTML = hoursHtml;

			// Populate minutes 00, 30
			minutesCol.innerHTML = ['00','30']
				.map(m => `<button type=\"button\" data-minute=\"${m}\" class=\"block w-full text-left px-4 py-2\">${m}</button>`)
				.join('');

			// Selection handling
			let selectedHour = input.value && input.value.includes(':') ? input.value.split(':')[0] : null;
			let selectedMinute = input.value && input.value.includes(':') ? input.value.split(':')[1] : null;

			const updateActive = () => {
				[...hoursCol.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.getAttribute('data-hour') === selectedHour));
				[...minutesCol.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.getAttribute('data-minute') === selectedMinute));
			};

			const scrollIntoViewSmooth = (btn, container) => {
				if (!btn) return;
				const top = btn.offsetTop - container.clientHeight / 2 + btn.clientHeight / 2;
				container.scrollTo({ top, behavior: 'smooth' });
			};

			const commit = () => {
				if (selectedHour && selectedMinute) {
					input.value = `${selectedHour}:${selectedMinute}`;
					hideTimePicker();
				}
			};

			hoursCol.addEventListener('click', (e) => {
				const btn = e.target.closest('button[data-hour]');
				if (!btn) return;
				selectedHour = btn.getAttribute('data-hour');
				updateActive();
				scrollIntoViewSmooth(btn, hoursCol);
				commit();
			});

			minutesCol.addEventListener('click', (e) => {
				const btn = e.target.closest('button[data-minute]');
				if (!btn) return;
				selectedMinute = btn.getAttribute('data-minute');
				updateActive();
				scrollIntoViewSmooth(btn, minutesCol);
				commit();
			});

			// Mark as initialized
			hoursCol.dataset.initialized = 'true';
		}

		picker.classList.remove('hidden');

		// If value exists, set active and center it
		let selectedHour = input.value && input.value.includes(':') ? input.value.split(':')[0] : null;
		let selectedMinute = input.value && input.value.includes(':') ? input.value.split(':')[1] : null;
		[...hoursCol.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.getAttribute('data-hour') === selectedHour));
		[...minutesCol.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.getAttribute('data-minute') === selectedMinute));
		scrollIntoViewSmooth(hoursCol.querySelector('button.active'), hoursCol);
		scrollIntoViewSmooth(minutesCol.querySelector('button.active'), minutesCol);

		// Click outside to close
		const outsideHandler = (ev) => {
			if (!picker.contains(ev.target) && ev.target !== input) {
				hideTimePicker();
				document.removeEventListener('click', outsideHandler);
			}
		};
		setTimeout(() => document.addEventListener('click', outsideHandler), 0);
	}

	function hideTimePicker() {
		const picker = document.getElementById('customTimePicker');
		picker.classList.add('hidden');
	}
	function openLightbox(imageSrc, imageAlt) {
		const lightbox = document.getElementById('lightbox');
		const lightboxImage = document.getElementById('lightboxImage');
		const lightboxTitle = document.getElementById('lightboxTitle');
		
		lightboxImage.src = imageSrc;
		lightboxImage.alt = imageAlt;
		lightboxTitle.textContent = imageAlt;
		
		lightbox.classList.remove('hidden');
		lightbox.classList.add('show');
		document.body.style.overflow = 'hidden';
	}
	
	function closeLightbox() {
		const lightbox = document.getElementById('lightbox');
		lightbox.classList.remove('show');
		lightbox.classList.add('hide');
		
		setTimeout(() => {
			lightbox.classList.add('hidden');
			lightbox.classList.remove('hide');
			document.body.style.overflow = 'auto';
		}, 300);
	}
	
	// Close lightbox when clicking outside the image
	document.getElementById('lightbox').addEventListener('click', function(e) {
		if (e.target === this) {
			closeLightbox();
		}
	});
	
	// Close lightbox with Escape key
	document.addEventListener('keydown', function(e) {
		if (e.key === 'Escape') {
			closeLightbox();
		}
	});

	// Booking form handling
	document.getElementById('bookingForm').addEventListener('submit', async function(e) {
		e.preventDefault();
		
		const bookNowBtn = document.getElementById('bookNowBtn');
		const btnText = document.getElementById('btnText');
		const btnLoading = document.getElementById('btnLoading');
		const bookingDate = document.getElementById('bookingDate').value;
		const bookingTime = document.getElementById('bookingTime').value;
		
		if (!bookingDate || !bookingTime) {
			alert('Vui lòng chọn đầy đủ ngày và giờ');
			return;
		}
		
		// Validate time range
		const selectedTime = new Date(`2000-01-01T${bookingTime}`);
		const minTime = new Date('2000-01-01T08:00');
		const maxTime = new Date('2000-01-01T22:00');
		
		if (selectedTime < minTime || selectedTime > maxTime) {
			alert('Vui lòng chọn giờ trong khoảng 8:00 - 22:00');
			return;
		}
		
		// Check if selected date is not in the past
		const selectedDate = new Date(bookingDate);
		const today = new Date();
		today.setHours(0, 0, 0, 0);
		
		if (selectedDate < today) {
			alert('Không thể đặt lịch trong quá khứ');
			return;
		}
		
		// Show loading state
		bookNowBtn.disabled = true;
		btnText.classList.add('hidden');
		btnLoading.classList.remove('hidden');
		
		try {
			const response = await fetch('@Url.Action("Create", "Booking")', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
				},
				body: JSON.stringify({
					conceptId: @Model.ConceptId,
					bookingDate: bookingDate,
					bookingTime: bookingTime
				})
			});
			
			const result = await response.json();
			
			if (result.success) {
				// Redirect to payment page
				window.location.href = result.redirectUrl;
			} else {
				alert(result.message || 'Có lỗi xảy ra khi tạo booking');
			}
		} catch (error) {
			console.error('Error:', error);
			alert('Có lỗi xảy ra khi tạo booking');
		} finally {
			// Reset button state
			bookNowBtn.disabled = false;
			btnText.classList.remove('hidden');
			btnLoading.classList.add('hidden');
		}
	});
</script>
