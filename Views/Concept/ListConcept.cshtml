@using MonAmour.Models
@model IEnumerable<Concept>

@{
	ViewData["Title"] = "Gói dịch vụ - MonAmour";
	var categories = ViewBag.Categories as List<ConceptCategory>;
	var selectedCat = ViewBag.SelectedCategoryId as int?;
	var page = ViewBag.Page ?? 1;
	var totalPages = ViewBag.TotalPages ?? 1;
	var currentPage = ViewBag.Page ?? 1;
	var cities = ViewBag.Cities as List<string>;
	string selectedCity = ViewBag.SelectedCity as string;
	string search = ViewBag.Search as string;
}

<div class="min-h-screen bg-beige">
	<!-- Hero Section -->
	<section class="py-20" style="background-color: #fbf1e6;">
		<div class="container mx-auto px-4">
			<!-- Main Message -->
			<div class="text-center mb-16">
				<h1 class="font-prata text-4xl md:text-5xl leading-tight max-w-4xl mx-auto" style="color: #62000d;">
					Chúng tôi mang đến không gian để tình yêu của bạn luôn được nuôi dưỡng và thăng hoa.
				</h1>
			</div>
			
			<!-- Image Carousel -->
			<div class="relative overflow-hidden p-8 rounded-2xl" style="background-color: #f0e6d2; border: 2px solid #62000d;">
				<div class="flex items-center space-x-6 transition-transform duration-500 ease-in-out" id="conceptCarousel" style="transform: translateX(0px);">
					@for (int i = 0; i < 5; i++)
					{
						var concept = Model?.Skip(i).FirstOrDefault();
						var img = concept?.ConceptImgs?.FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? concept?.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=500&h=400&fit=crop";
						
						<div class="concept-card flex-shrink-0 w-64 transition-all duration-300 cursor-pointer" data-index="@i" onclick="selectCard(@i)">
							@if (concept != null)
							{
								<a href="@Url.Action("ConceptDetail","Concept", new { id = concept.ConceptId })" class="group block focus:outline-none">
									<div class="carousel-card rounded-lg overflow-hidden shadow-lg transition-all duration-300">
										<img src="@img" alt="@concept.Name" class="w-full h-64 object-cover transform transition-transform duration-300 group-hover:scale-105">
									</div>
									<div class="mt-3 text-center">
										<h3 class="font-prata text-lg font-bold group-hover:underline" style="color: #62000d;">@concept.Name</h3>
									</div>
								</a>
							}
							else
							{
								<div class="carousel-card rounded-lg overflow-hidden shadow-lg transition-all duration-300">
									<img src="@img" alt="Concept" class="w-full h-64 object-cover">
								</div>
							}
						</div>
					}
				</div>
			</div>
			
			<!-- Bottom Section -->
			<div class="mt-16 flex items-center justify-between">
				<!-- Left: Highlights -->
				<div class="flex-1">
					<h2 class="font-prata text-2xl mb-4" style="color: #62000d;">NỔI BẬT</h2>
					<p class="font-noto-serif leading-relaxed max-w-md" style="color: #62000d;">
						Khám phá những gói dịch vụ đặc biệt được thiết kế riêng cho từng cặp đôi, 
						tạo nên những khoảnh khắc đáng nhớ và ý nghĩa nhất.
					</p>
				</div>
				
				<!-- Right: Navigation Arrows -->
				<div class="flex space-x-2">
					<button id="prevBtnBottom" class="w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200" style="background-color: #62000d; color: #fbf1e6;" onmouseover="this.style.backgroundColor='#4a0009'" onmouseout="this.style.backgroundColor='#62000d'">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
						</svg>
					</button>
					<button id="nextBtnBottom" class="w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200" style="background-color: #62000d; color: #fbf1e6;" onmouseover="this.style.backgroundColor='#4a0009'" onmouseout="this.style.backgroundColor='#62000d'">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</button>
				</div>
			</div>
		</div>
	</section>

	<!-- Service Packages Section -->
	<section class="py-16" style="background-color: #fbf1e6;">
		<div class="container mx-auto px-4">
			<!-- Section Title -->
			<div class="text-center mb-12">
				<h2 class="font-prata text-4xl md:text-5xl mb-8" style="color: #62000d;">Gói dịch vụ</h2>
				
				<!-- Search and City Filter -->
				<form method="get" action="@Url.Action("ListConcept","Concept")" class="max-w-5xl mx-auto mb-10">
					<input type="hidden" name="categoryId" value="@(selectedCat?.ToString() ?? "")" />
					<div class="filter-bar flex flex-col md:flex-row items-stretch md:items-center gap-3 md:gap-4">
						<input name="q" value="@search" placeholder="Tìm theo địa chỉ, khu vực, thành phố..."
							class="input w-full md:flex-1" />
						<select name="city" class="select w-full md:w-60">
							<option value="">Tất cả thành phố</option>
							@if (cities != null)
							{
								foreach (var c in cities)
								{
									@if (selectedCity == c)
									{
										<option value="@c" selected="selected">@c</option>
									}
									else
									{
										<option value="@c">@c</option>
									}
								}
							}
						</select>
						<div class="flex gap-3 md:ml-2">
							<button type="submit" class="btn-primary">Lọc</button>
							<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = 1 })" class="btn-outline">Xóa lọc</a>
						</div>
					</div>
				</form>

				<!-- Category Filter Tabs -->
				<div class="flex flex-wrap items-center justify-center gap-3 md:gap-4 mb-12">
					<a href="@Url.Action("ListConcept","Concept", new { categoryId = (int?)null, page = 1, city = selectedCity, q = search })" class="pill @(selectedCat==null?"pill-active":"")">Tất cả dịch vụ</a>
					@foreach (var cat in categories)
					{
						var active = selectedCat == cat.CategoryId;
						<a href="@Url.Action("ListConcept","Concept", new { categoryId = cat.CategoryId, page = 1, city = selectedCity, q = search })" class="pill @(active?"pill-active":"")">@cat.Name</a>
					}
				</div>
			</div>

			@if (Model == null || !Model.Any())
			{
				<div class="rounded p-6 text-center" style="background-color: #f0e6d2; border: 1px solid #62000d;">
					<p class="font-noto-serif" style="color: #62000d;">Không tìm thấy gói dịch vụ nào.</p>
				</div>
			}
			else
			{
				<!-- Service Grid -->
				<div class="concept-grid mb-12">
					@foreach (var c in Model)
					
					{ <div> @{
						var firstImg = c.ConceptImgs?.OrderBy(i => i.DisplayOrder).FirstOrDefault();
						<a href="@Url.Action("ConceptDetail", "Concept", new { id = c.ConceptId })" class="group block">
							<div class="rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300" style="background-color: white; border: 1px solid #62000d;">
								<div class="aspect-square overflow-hidden" style="background-color: #f0e6d2;">
									@if (!string.IsNullOrWhiteSpace(firstImg?.ImgUrl))
									{
										<img src="@firstImg.ImgUrl" alt="@firstImg?.AltText" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
									}
									else
									{
										<div class="w-full h-full flex items-center justify-center font-noto-serif" style="color: #62000d;">No Image</div>
									}
								</div>
								<div class="p-6 text-center">
									<h3 class="font-prata text-lg font-bold mb-2" style="color: #62000d;">@c.Name</h3>
									@if (c.Price.HasValue)
									{
										<p class="font-noto-serif mb-2" style="color: #62000d;">@String.Format("{0:N0}₫", c.Price.Value)</p>
									}
									@if (!string.IsNullOrWhiteSpace(c.Description))
									{
										<p class="font-noto-serif text-sm mb-3 line-clamp-2" style="color: #62000d;">@c.Description</p>
									}
									
									<!-- Location Info - Compact -->
									@if (c.Location != null)
									{
										<div class="mb-3">
											@if (!string.IsNullOrWhiteSpace(c.Location.Address))
											{
												<p class="font-noto-serif text-xs mb-1" style="color: #62000d;">@c.Location.Address</p>
											}
											@if (!string.IsNullOrWhiteSpace(c.Location.District) || !string.IsNullOrWhiteSpace(c.Location.City))
											{
												<p class="font-noto-serif text-xs mb-1" style="color: #62000d; opacity: 0.8;">
													@(!string.IsNullOrWhiteSpace(c.Location.District) ? c.Location.District : "")
													@(!string.IsNullOrWhiteSpace(c.Location.District) && !string.IsNullOrWhiteSpace(c.Location.City) ? ", " : "")
													@(!string.IsNullOrWhiteSpace(c.Location.City) ? c.Location.City : "")
												</p>
											}
											@if (!string.IsNullOrWhiteSpace(c.Location.GgmapLink))
											{
												<a href="@c.Location.GgmapLink" target="_blank" class="inline-flex items-center space-x-1 text-xs font-noto-serif hover:underline" style="color: #62000d;">
													<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
														<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
													</svg>
													<span>Xem bản đồ</span>
												</a>
											}
										</div>
									}

											<a href="@Url.Action("ConceptDetail", "Concept", new { id = c.ConceptId })" class="w-full py-2 rounded-lg font-medium transition-colors duration-200 block text-center cta-btn" style="background-color: #62000d; color: #fbf1e6;" onmouseover="this.style.backgroundColor='#4a0009'" onmouseout="this.style.backgroundColor='#62000d'">
												Liên hệ ngay
											</a>
								</div>
							</div>
						</a>
							}
						</div>
					}
				</div>

				<!-- Pagination -->
				@if (totalPages > 1)
				{
					<div class="flex items-center justify-center gap-4 mt-8">
						<!-- Previous Button -->
						@if (currentPage > 1)
						{
							<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = currentPage - 1, city = selectedCity, q = search })" 
							   class="flex items-center justify-center w-10 h-10 rounded-full bg-wine-red text-beige hover:bg-wine-red/90 transition-colors duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
								</svg>
							</a>
						}
						else
						{
							<div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 cursor-not-allowed">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
								</svg>
							</div>
						}

						<!-- Page Numbers -->
						<div class="flex items-center gap-2">
							@{
								int startPage = Math.Max(1, currentPage - 2);
								int endPage = Math.Min(totalPages, currentPage + 2);
								
								// Show first page if not in range
								if (startPage > 1)
								{
									<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = 1, city = selectedCity, q = search })" 
									   class="flex items-center justify-center w-10 h-10 rounded-full bg-beige text-wine-red hover:bg-wine-red hover:text-beige transition-colors duration-200 font-prata">
										1
									</a>
									if (startPage > 2)
									{
										<span class="text-wine-red font-prata">...</span>
									}
								}
								
								// Show page numbers in range
								for (int p = startPage; p <= endPage; p++)
								{
									<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = p, city = selectedCity, q = search })" 
									   class="flex items-center justify-center w-10 h-10 rounded-full @(p == currentPage ? "bg-wine-red text-beige" : "bg-beige text-wine-red hover:bg-wine-red hover:text-beige") transition-colors duration-200 font-prata">
										@p
									</a>
								}
								
								// Show last page if not in range
								if (endPage < totalPages)
								{
									if (endPage < totalPages - 1)
									{
										<span class="text-wine-red font-prata">...</span>
									}
									<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = totalPages, city = selectedCity, q = search })" 
									   class="flex items-center justify-center w-10 h-10 rounded-full bg-beige text-wine-red hover:bg-wine-red hover:text-beige transition-colors duration-200 font-prata">
										@totalPages
									</a>
								}
							}
						</div>

						<!-- Next Button -->
						@if (currentPage < totalPages)
						{
							<a href="@Url.Action("ListConcept","Concept", new { categoryId = selectedCat, page = currentPage + 1, city = selectedCity, q = search })" 
							   class="flex items-center justify-center w-10 h-10 rounded-full bg-wine-red text-beige hover:bg-wine-red/90 transition-colors duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
								</svg>
							</a>
						}
						else
						{
							<div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 cursor-not-allowed">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
								</svg>
							</div>
						}
					</div>
				}
			}
		</div>
	</section>
</div>

<style>
	/* Inputs & buttons */
	.input {
		padding: 0.75rem 1rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		background: #fff;
		color: #62000d;
	}
	.select {
		padding: 0.75rem 1rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		background: #fff;
		color: #62000d;
	}
	.btn-primary {
		padding: 0.6rem 1.25rem;
		border-radius: 0.5rem;
		background-color: #62000d;
		color: #fbf1e6;
		transition: background-color .2s ease, box-shadow .2s ease;
		box-shadow: 0 4px 12px rgba(98, 0, 13, 0.2);
	}
	.btn-primary:hover { background-color: #4a0009; }
	.btn-outline {
		padding: 0.6rem 1.25rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		color: #62000d;
		background: transparent;
	}

	/* Force original CTA colors */
	.cta-btn {
		background: #62000d !important;
		background-image: none !important;
		color: #fbf1e6 !important;
		border: 1px solid #62000d !important;
		opacity: 1 !important;
		filter: none !important;
		box-shadow: none !important;
		cursor: pointer !important;
		text-shadow: none !important;
	}
	/* Extra specificity inside concept grid */
	.concept-grid a.cta-btn {
		background: #62000d !important;
		background-image: none !important;
		color: #fbf1e6 !important;
		border-color: #62000d !important;
		opacity: 1 !important;
		filter: none !important;
		box-shadow: none !important;
	}
	.cta-btn:hover,
	.concept-grid a.cta-btn:hover {
		background: #4a0009 !important;
		background-image: none !important;
		color: #fbf1e6 !important;
		border-color: #4a0009 !important;
	}

	/* Category pills */
	.pill {
		padding: 0.65rem 1rem;
		border-radius: 9999px;
		border: 1px solid #62000d;
		color: #62000d;
		background-color: #f0e6d2;
		font-size: .9rem;
		transition: background-color .2s ease, color .2s ease, box-shadow .2s ease;
	}
	.pill:hover { background-color: #e6d4c0; }
	.pill-active {
		background-color: #62000d;
		border-color: #62000d;
		color: #fbf1e6;
		box-shadow: 0 6px 16px rgba(98,0,13,.25);
	}

	/* Concept card polish */
	.concept-grid .rounded-lg {
		border: 1px solid #d7c2b8 !important;
		border-radius: 14px !important;
		background: linear-gradient(180deg, #ffffff, #fbf1e6) !important;
		box-shadow: 0 8px 20px rgba(98, 0, 13, 0.12) !important;
		transition: transform .2s ease, box-shadow .2s ease !important;
	}
	.concept-grid .rounded-lg:hover {
		transform: translateY(-4px) !important;
		box-shadow: 0 14px 28px rgba(98, 0, 13, 0.18) !important;
	}
	.concept-grid .aspect-square { border-bottom: 1px solid #ead8cd; }
	.concept-grid .group:hover .aspect-square img { transform: scale(1.05); }
	.concept-grid .p-6 { padding: 1.1rem 1rem !important; }
	.concept-grid .font-prata.text-lg { font-size: 1.15rem; }
	.concept-grid .font-noto-serif.mb-2 { font-weight: 600; }
	.concept-grid .w-full.py-2 { margin-top: .6rem; }

	/* Top carousel cards */
	.carousel-card { background: #ffffff; border: 1px solid #62000d; }
	#conceptCarousel .group:hover .carousel-card { box-shadow: 0 12px 24px rgba(98,0,13,.18); }

	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	
	/* Force 4 columns on desktop */
	.concept-grid {
		display: grid !important;
		grid-template-columns: repeat(4, 1fr) !important;
		gap: 1.5rem;
	}
	
	/* Responsive breakpoints */
	@@media (max-width: 1200px) {
		.concept-grid {
			grid-template-columns: repeat(3, 1fr) !important;
		}
	}
	
	@@media (max-width: 900px) {
		.concept-grid {
			grid-template-columns: repeat(2, 1fr) !important;
		}
	}
	
	@@media (max-width: 600px) {
		.concept-grid {
			grid-template-columns: 1fr !important;
		}
	}
	
</style>

<script>
	// Concept Carousel
	let currentIndex = 0;
	const totalCards = 5;
	const carousel = document.getElementById('conceptCarousel');
	const prevBtnBottom = document.getElementById('prevBtnBottom');
	const nextBtnBottom = document.getElementById('nextBtnBottom');
	const cardWidth = 280; // w-64 + gap (256px + 24px)
	const centerCardWidth = 320; // w-80 for center card

	function updateCarousel() {
		// Calculate translateX to center the current card
		const containerWidth = carousel.parentElement.offsetWidth;
		const totalCardsWidth = (totalCards * cardWidth) - cardWidth + centerCardWidth;
		const startOffset = (containerWidth - totalCardsWidth) / 2;
		const translateX = startOffset - (currentIndex * cardWidth);
		carousel.style.transform = `translateX(${translateX}px)`;
		
		// Update card sizes - center card is larger
		const cards = carousel.querySelectorAll('.concept-card');
		cards.forEach((card, index) => {
			card.classList.remove('w-80', 'w-64');
			if (index === currentIndex) {
				card.classList.add('w-80');
				// Add special styling for center card
				card.style.transform = 'scale(1.05)';
				card.style.zIndex = '10';
				card.style.boxShadow = '0 15px 30px rgba(98, 0, 13, 0.2)';
			} else {
				card.classList.add('w-64');
				// Reset styling for non-center cards
				card.style.transform = 'scale(1)';
				card.style.zIndex = '1';
				card.style.boxShadow = '0 8px 16px rgba(0, 0, 0, 0.1)';
			}
		});
	}

	function selectCard(index) {
		currentIndex = index;
		updateCarousel();
	}

	function moveCarousel(direction) {
		if (direction === 'prev') {
			currentIndex = (currentIndex - 1 + totalCards) % totalCards;
		} else {
			currentIndex = (currentIndex + 1) % totalCards;
		}
		updateCarousel();
	}

	// Event listeners for bottom arrows only
	prevBtnBottom.addEventListener('click', () => moveCarousel('prev'));
	nextBtnBottom.addEventListener('click', () => moveCarousel('next'));

	// Initialize carousel
	updateCarousel();

	// Recalculate on window resize
	window.addEventListener('resize', updateCarousel);
</script>
