
@using MonAmour.Models
@model IEnumerable<Concept>

@{
	ViewData["Title"] = "Gói Dịch Vụ - Mon Amour";
    var categories = ViewBag.Categories as List<ConceptCategory> ?? new List<ConceptCategory>();
	var selectedCat = ViewBag.SelectedCategoryId as int?;
	var page = ViewBag.Page ?? 1;
	var totalPages = ViewBag.TotalPages ?? 1;
	var currentPage = ViewBag.Page ?? 1;
    var cities = ViewBag.Cities as List<string> ?? new List<string>();
    string selectedCity = ViewBag.SelectedCity?.ToString() ?? "";
    string search = ViewBag.Search?.ToString() ?? "";
}

<div class="min-h-screen bg-beige">
	<!-- Hero Section -->
	<section class="py-20" style="background-color: #fbf1e6;">
		<div class="container mx-auto px-4">
			<!-- Main Message -->
			<div class="text-center mb-16">
				<h1 class="font-prata text-4xl md:text-5xl leading-tight max-w-4xl mx-auto" style="color: #62000d;">
					Chúng tôi mang đến không gian để tình yêu của bạn luôn được nuôi dưỡng và thăng hoa.
				</h1>
			</div>
			
            <!-- Enhanced Carousel Section -->
            <div class="carousel-section mb-16">
                <div class="carousel-container relative overflow-hidden h-[450px] md:h-[360px] flex items-center justify-center" id="carouselContainer">
                    <div class="carousel-track flex transition-transform duration-300 ease-in-out" id="track">
                        @if (Model != null && Model.Any())
                        {
                            var concepts = Model.Take(5).ToList();
                             // Add last item as first clone for infinite loop
                             var lastConcept = concepts.LastOrDefault();
                             if (lastConcept != null)
                             {
                                 var lastImg = lastConcept.ConceptImgs?.OrderBy(i => i.DisplayOrder).FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? lastConcept.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=300&h=200&fit=crop";
                                 <div class="carousel-item flex-shrink-0 w-[280px] h-[360px] mx-4 rounded-lg overflow-hidden shadow-md transition-all duration-600 ease-in-out">
                                     <a href="@Url.Action("ConceptDetail", "Concept", new { id = lastConcept.ConceptId })" class="block h-full relative">
                                         <img src="@lastImg" alt="@lastConcept.Name" class="w-full h-full object-cover">
                                         <div class="carousel-caption absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 opacity-0 transition-opacity duration-300">
                                             <h3 class="text-sm font-medium">@lastConcept.Name</h3>
                                         </div>
                                     </a>
                                 </div>
                             }
                            @foreach (var concept in concepts)
                            {
                                var img = concept.ConceptImgs?.OrderBy(i => i.DisplayOrder).FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? concept.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=300&h=200&fit=crop";
                                <div class="carousel-item flex-shrink-0 w-[280px] h-[360px] mx-4 rounded-lg overflow-hidden shadow-md transition-all duration-600 ease-in-out">
                                    <a href="@Url.Action("ConceptDetail", "Concept", new { id = concept.ConceptId })" class="block h-full relative">
                                        <img src="@img" alt="@concept.Name" class="w-full h-full object-cover">
                                        <div class="carousel-caption absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 opacity-0 transition-opacity duration-300">
                                            <h3 class="text-sm font-medium">@concept.Name</h3>
                                        </div>
                                    </a>
							</div>
                            }
                             // Add first item as last clone for infinite loop
                             var firstConcept = concepts.FirstOrDefault();
                             if (firstConcept != null)
                             {
                                 var firstImg = firstConcept.ConceptImgs?.OrderBy(i => i.DisplayOrder).FirstOrDefault(img => img.IsPrimary == true)?.ImgUrl ?? firstConcept.ConceptImgs?.FirstOrDefault()?.ImgUrl ?? "https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=300&h=200&fit=crop";
                                 <div class="carousel-item flex-shrink-0 w-[280px] h-[360px] mx-4 rounded-lg overflow-hidden shadow-md transition-all duration-600 ease-in-out">
                                     <a href="@Url.Action("ConceptDetail", "Concept", new { id = firstConcept.ConceptId })" class="block h-full relative">
                                         <img src="@firstImg" alt="@firstConcept.Name" class="w-full h-full object-cover">
                                         <div class="carousel-caption absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 opacity-0 transition-opacity duration-300">
                                             <h3 class="text-sm font-medium">@firstConcept.Name</h3>
                                     </div>
                                 </a>
                                 </div>
                             }
                             }
                             else
                             {
                            // Fallback placeholder items
                            for (int i = 0; i < 5; i++)
                            {
                                <div class="carousel-item flex-shrink-0 w-[280px] h-[360px] mx-4 rounded-lg overflow-hidden shadow-md transition-all duration-600 ease-in-out">
                                    <div class="h-full relative">
                                        <img src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=300&h=200&fit=crop" alt="Placeholder" class="w-full h-full object-cover">
                                        <div class="carousel-caption absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 opacity-0 transition-opacity duration-300">
                                            <h3 class="text-sm font-medium">Placeholder</h3>
                                        </div>
                                    </div>
                        </div>
                            }
                    }
                </div>
            </div>
			
                <!-- Navigation and Highlights -->
                <div class="flex items-end justify-between mt-6">
                    <div class="max-w-xl">
                        <h2 class="text-2xl font-bold mb-4 font-prata" style="color: #62000d;">Nổi Bật</h2>
                        <p class="text-xl leading-relaxed font-body" style="color: #62000d;">
                            Khám phá những trải nghiệm đặc biệt được tuyển chọn, mang đến cảm xúc khó quên cho bạn và người ấy.
					</p>
				</div>
                    <div class="flex items-center gap-4">
                        <button id="prevBtnBottom" class="nav-arrow w-10 h-10 rounded-full border border-[#62000d] text-[#62000d] hover:bg-[#62000d] hover:text-[#fbf1e6] transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
						</svg>
					</button>
                        <button id="nextBtnBottom" class="nav-arrow w-10 h-10 rounded-full border border-[#62000d] text-[#62000d] hover:bg-[#62000d] hover:text-[#fbf1e6] transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</button>
                    </div>
				</div>
			</div>
		</div>
	</section>

	<!-- Service Packages Section -->
	<section class="py-16" style="background-color: #fbf1e6;">
		<div class="container mx-auto px-4">
			<!-- Section Title -->
			<div class="text-center mb-12">
				<h2 class="font-prata text-4xl md:text-5xl mb-8" style="color: #62000d;">Gói Dịch Vụ</h2>
				
				<!-- Search and City Filter -->
                <form method="get" action="@Url.Action("ListConcept", "Concept")" class="max-w-5xl mx-auto mb-10">
					<input type="hidden" name="categoryId" value="@(selectedCat?.ToString() ?? "")" />
					<div class="filter-bar flex flex-col md:flex-row items-stretch md:items-center gap-3 md:gap-4">
                        <input name="q" value="@search" placeholder="Tìm theo địa chỉ, khu vực, thành phố..." class="input w-full md:flex-1" />
						<select name="city" class="select w-full md:w-60">
							<option value="">Tất cả thành phố</option>
                             @foreach (var c in cities)
                             {
                                 <option value="@c" selected="@(selectedCity == c)">@c</option>
							}
						</select>
						<select name="sortBy" class="select w-full md:w-48">
							<option value="">Sắp xếp theo</option>
							<option value="price_asc" selected="@(ViewBag.SortBy == "price_asc")">Giá tăng dần</option>
							<option value="price_desc" selected="@(ViewBag.SortBy == "price_desc")">Giá giảm dần</option>
							<option value="name_asc" selected="@(ViewBag.SortBy == "name_asc")">Tên A-Z</option>
							<option value="name_desc" selected="@(ViewBag.SortBy == "name_desc")">Tên Z-A</option>
						</select>
						<div class="flex gap-3 md:ml-2">
							<button type="submit" class="btn-primary">Lọc</button>
                            <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = 1 })" class="btn-outline">Xóa lọc</a>
						</div>
					</div>
				</form>
				
				<!-- Category Filter Tabs -->
				<div class="flex flex-wrap items-center justify-center gap-3 md:gap-4 mb-12">
                    <a href="@Url.Action("ListConcept", "Concept", new { categoryId = (int?)null, page = 1, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="pill @(selectedCat == null ? "pill-active" : "")">Tất cả dịch vụ</a>
					@foreach (var cat in categories)
					{
						var active = selectedCat == cat.CategoryId;
                        <a href="@Url.Action("ListConcept", "Concept", new { categoryId = cat.CategoryId, page = 1, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="pill @(active ? "pill-active" : "")">@cat.Name</a>
					}
				</div>
			</div>

			@if (Model == null || !Model.Any())
			{
				<div class="rounded p-6 text-center" style="background-color: #f0e6d2; border: 1px solid #62000d;">
                    <p class="font-body" style="color: #62000d;">Không tìm thấy gói dịch vụ nào.</p>
				</div>
			}
			else
			{
				<!-- Service Grid -->
				<div class="concept-grid mb-12">
					@foreach (var c in Model)
                     {
                         <div>
                             @{
						var firstImg = c.ConceptImgs?.OrderBy(i => i.DisplayOrder).FirstOrDefault();
						<a href="@Url.Action("ConceptDetail", "Concept", new { id = c.ConceptId })" class="group block">
							<div class="rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300" style="background-color: white; border: 1px solid #62000d;">
								<div class="aspect-square overflow-hidden" style="background-color: #f0e6d2;">
                                             @if (firstImg != null && !string.IsNullOrWhiteSpace(firstImg.ImgUrl))
									{
                                                 <img src="@firstImg.ImgUrl" alt="@(firstImg.AltText ?? c.Name)" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
									}
									else
									{
                                        <div class="w-full h-full flex items-center justify-center font-body" style="color: #62000d;">No Image</div>
									}
								</div>
								<div class="p-6 text-center">
									<h3 class="font-prata text-lg font-bold mb-2" style="color: #62000d;">@c.Name</h3>
									@if (c.Price.HasValue)
                                    {
                                        <p class="font-body mb-2" style="color: #62000d;">@String.Format("{0:N0}₫", c.Price.Value)</p>
									}
									@if (c.Location != null)
									{
										<div class="mb-3">
											@if (!string.IsNullOrWhiteSpace(c.Location.Address))
											{
                                                <p class="font-body text-xs mb-1" style="color: #62000d;">@c.Location.Address</p>
											}
											@if (!string.IsNullOrWhiteSpace(c.Location.District) || !string.IsNullOrWhiteSpace(c.Location.City))
											{
                                                <p class="font-body text-xs mb-1" style="color: #62000d; opacity: 0.8;">
													@(!string.IsNullOrWhiteSpace(c.Location.District) ? c.Location.District : "")
													@(!string.IsNullOrWhiteSpace(c.Location.District) && !string.IsNullOrWhiteSpace(c.Location.City) ? ", " : "")
													@(!string.IsNullOrWhiteSpace(c.Location.City) ? c.Location.City : "")
												</p>
											}
											@if (!string.IsNullOrWhiteSpace(c.Location.GgmapLink))
											{
                                                <a href="@c.Location.GgmapLink" target="_blank" class="inline-flex items-center space-x-1 text-xs font-body hover:underline" style="color: #62000d;">
													<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
														<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
													</svg>
													<span>Xem bản đồ</span>
												</a>
											}
										</div>
									}
                                            <a href="@Url.Action("ConceptDetail", "Concept", new { id = c.ConceptId })" class="w-full py-2.5 rounded-lg font-extrabold tracking-wide transition-all duration-200 block text-center cta-btn">
                                                LIÊN HỆ NGAY
											</a>
								</div>
							</div>
						</a>
							}
						</div>
					}
				</div>

				<!-- Pagination -->
				@if (totalPages > 1)
				{
					<div class="flex items-center justify-center gap-4 mt-8">
						@if (currentPage > 1)
						{
                            <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = currentPage - 1, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="flex items-center justify-center w-10 h-10 rounded-full bg-wine-red text-beige hover:bg-wine-red/90 transition-colors duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
								</svg>
							</a>
						}
						else
						{
							<div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 cursor-not-allowed">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
								</svg>
							</div>
						}

						<div class="flex items-center gap-2">
							@{
								int startPage = Math.Max(1, currentPage - 2);
								int endPage = Math.Min(totalPages, currentPage + 2);
								
								if (startPage > 1)
								{
                                    <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = 1, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="flex items-center justify-center w-10 h-10 rounded-full bg-beige text-wine-red hover:bg-wine-red hover:text-beige transition-colors duration-200 font-prata">
										1
									</a>
									if (startPage > 2)
									{
										<span class="text-wine-red font-prata">...</span>
									}
								}
								
								for (int p = startPage; p <= endPage; p++)
								{
                                    <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = p, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="flex items-center justify-center w-10 h-10 rounded-full @(p == currentPage ? "bg-wine-red text-beige" : "bg-beige text-wine-red hover:bg-wine-red hover:text-beige") transition-colors duration-200 font-prata">
										@p
									</a>
								}
								
								if (endPage < totalPages)
								{
									if (endPage < totalPages - 1)
									{
										<span class="text-wine-red font-prata">...</span>
									}
                                    <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = totalPages, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="flex items-center justify-center w-10 h-10 rounded-full bg-beige text-wine-red hover:bg-wine-red hover:text-beige transition-colors duration-200 font-prata">
										@totalPages
									</a>
								}
							}
						</div>

						@if (currentPage < totalPages)
						{
                            <a href="@Url.Action("ListConcept", "Concept", new { categoryId = selectedCat, page = currentPage + 1, city = selectedCity, q = search, sortBy = ViewBag.SortBy })" class="flex items-center justify-center w-10 h-10 rounded-full bg-wine-red text-beige hover:bg-wine-red/90 transition-colors duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
								</svg>
							</a>
						}
						else
						{
							<div class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 cursor-not-allowed">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
								</svg>
							</div>
						}
					</div>
				}
			}
		</div>
	</section>
</div>

<style>
    /* Existing styles retained */
	.input {
		padding: 0.75rem 1rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		background: #fff;
		color: #62000d;
	}
	.select {
		padding: 0.75rem 1rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		background: #fff;
		color: #62000d;
	}
	.btn-primary {
		padding: 0.6rem 1.25rem;
		border-radius: 0.5rem;
		background-color: #62000d;
		color: #fbf1e6;
		transition: background-color .2s ease, box-shadow .2s ease;
		box-shadow: 0 4px 12px rgba(98, 0, 13, 0.2);
	}
	.btn-primary:hover { background-color: #4a0009; }
	.btn-outline {
		padding: 0.6rem 1.25rem;
		border-radius: 0.5rem;
		border: 1px solid #62000d;
		color: #62000d;
		background: transparent;
	}
	.pill {
		padding: 0.65rem 1rem;
		border-radius: 9999px;
		border: 1px solid #62000d;
		color: #62000d;
		background-color: #f0e6d2;
		font-size: .9rem;
		transition: background-color .2s ease, color .2s ease, box-shadow .2s ease;
	}
	.pill:hover { background-color: #e6d4c0; }
	.pill-active {
		background-color: #62000d;
		border-color: #62000d;
		color: #fbf1e6;
		box-shadow: 0 6px 16px rgba(98,0,13,.25);
	}
    .concept-grid {
        display: grid !important;
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 1.5rem;
    }
	.concept-grid .rounded-lg {
		border: 1px solid #d7c2b8 !important;
		border-radius: 14px !important;
		background: linear-gradient(180deg, #ffffff, #fbf1e6) !important;
		box-shadow: 0 8px 20px rgba(98, 0, 13, 0.12) !important;
		transition: transform .2s ease, box-shadow .2s ease !important;
	}
	.concept-grid .rounded-lg:hover {
		transform: translateY(-4px) !important;
		box-shadow: 0 14px 28px rgba(98, 0, 13, 0.18) !important;
	}
	.concept-grid .aspect-square { border-bottom: 1px solid #ead8cd; }
	.concept-grid .group:hover .aspect-square img { transform: scale(1.05); }
	.concept-grid .p-6 { padding: 1.1rem 1rem !important; }
	.concept-grid .font-prata.text-lg { font-size: 1.15rem; }
	.concept-grid .font-noto-serif.mb-2 { font-weight: 600; }
	.concept-grid .w-full.py-2 { margin-top: .6rem; }
    .cta-btn {
        background: #ffd166 !important; /* vàng ấm để nổi bật */
        color: #62000d !important; /* chữ đỏ rượu tương phản */
        border: 1px solid #e0b54d !important;
        box-shadow: 0 6px 14px rgba(98, 0, 13, 0.18), 0 0 0 3px rgba(255, 209, 102, 0.25);
    }
    .cta-btn:hover {
        background: #ffbe3b !important;
        border-color: #d6a43f !important;
        transform: translateY(-1px);
        box-shadow: 0 10px 18px rgba(98, 0, 13, 0.25), 0 0 0 4px rgba(255, 209, 102, 0.35);
    }

    /* Enhanced Carousel Styles */
    .carousel-container {
        position: relative;
        width: 100%;
        overflow: hidden;
    }
    .carousel-track {
        display: flex;
    }
    .carousel-item {
        flex: 0 0 280px;
        height: 360px;
        margin: 0 16px;
        border-radius: 16px;
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, box-shadow 0.3s ease;
    }
    .carousel-item.active {
        transform: scale(1.15);
        opacity: 1;
        z-index: 2;
        box-shadow: 0 8px 24px rgba(98, 0, 13, 0.2);
    }
    .carousel-item.side {
        transform: scale(0.95);
        opacity: 0.8;
        z-index: 1;
    }
    .carousel-item.far {
        transform: scale(0.8);
        opacity: 0.5;
        z-index: 0;
    }
    .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .carousel-caption {
        opacity: 0;
    }
    .carousel-item.active .carousel-caption {
        opacity: 1;
    }
    .nav-arrow {
        transition: all 0.2s ease;
    }
    .nav-arrow:hover {
        background-color: #62000d;
        color: #fbf1e6;
    }
     @@media (max-width: 768px) {
         .carousel-container {
            height: 280px;
         }
         .carousel-item {
            flex: 0 0 210px;
            height: 240px;
            margin: 0 8px;
         }
         .carousel-caption h3 { font-size: .9rem; }
         .nav-arrow { width: 2.25rem; height: 2.25rem; }
         .concept-grid { gap: 1rem; }
         .concept-grid .p-6 { padding: .9rem .85rem !important; }
         .concept-grid .font-prata.text-lg { font-size: 1.05rem; }
     }
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	@@media (max-width: 1200px) {
		.concept-grid {
			grid-template-columns: repeat(3, 1fr) !important;
			gap: 1.25rem;
		}
	}
	@@media (max-width: 640px) {
		.concept-grid {
			grid-template-columns: repeat(2, 1fr) !important;
			gap: .9rem;
		}
		.carousel-container { height: 240px; }
		.carousel-item { flex: 0 0 180px; height: 210px; margin: 0 6px; }
		.nav-arrow { width: 2rem; height: 2rem; }
	}
	@@media (max-width: 480px) {
		.concept-grid {
			grid-template-columns: repeat(2, 1fr) !important;
		}
	}
	@@media (max-width: 389px) {
		.concept-grid {
			grid-template-columns: 1fr !important;
		}
		.carousel-container { height: 220px; }
		.carousel-item { flex: 0 0 160px; height: 190px; }
	}
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const track = document.getElementById('track');
        const container = document.getElementById('carouselContainer');
        const prevBtn = document.getElementById('prevBtnBottom');
        const nextBtn = document.getElementById('nextBtnBottom');
        
        if (!track || !container || !prevBtn || !nextBtn) {
            console.warn('Carousel elements not found');
            return;
        }

        let items = Array.from(track.children);
        if (items.length === 0) {
            console.warn('No carousel items found');
            return;
        }

        const itemWidth = 280 + 32; // width + margin
        let current = 1; // Start at first real item (after first clone)
        let isTransitioning = false;
        let autoPlayInterval = null;

        function updateCarousel(animate = true) {
            if (isTransitioning && animate) return;
            
            if (!animate) {
                track.style.transition = 'none';
            } else {
                track.style.transition = 'transform 0.3s ease-in-out';
                isTransitioning = true;
            }

            const offset = (track.clientWidth / 2) - (itemWidth / 2) - (current * itemWidth);
            track.style.transform = `translateX(${offset}px)`;

            items.forEach((item, index) => {
                item.classList.remove('active', 'side', 'far');
                if (index === current) {
                    item.classList.add('active');
                } else if (Math.abs(index - current) === 1) {
                    item.classList.add('side');
			} else {
                    item.classList.add('far');
			}
		});
	}

        function startAutoplay() {
            stopAutoplay();
            autoPlayInterval = setInterval(() => {
                if (!isTransitioning) {
                    current++;
                    updateCarousel();
                }
            }, 2500);
        }

        function stopAutoplay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }
        }

        // Event listeners
        prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!isTransitioning) {
                current--;
                updateCarousel();
            }
        });

        nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!isTransitioning) {
                current++;
		updateCarousel();
	}
        });

        track.addEventListener('transitionend', () => {
            isTransitioning = false;
            
            if (current === items.length - 1) {
                current = 1;
                updateCarousel(false);
            } else if (current === 0) {
                current = items.length - 2;
                updateCarousel(false);
            }
        });

        // Hover pause
        container.addEventListener('mouseenter', stopAutoplay);
        container.addEventListener('mouseleave', startAutoplay);

        // Touch support
        let startX = 0;
        container.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            stopAutoplay();
        }, { passive: true });

        container.addEventListener('touchend', (e) => {
            const distX = e.changedTouches[0].clientX - startX;
            if (Math.abs(distX) > 50 && !isTransitioning) {
                if (distX > 0) {
                    current--;
		} else {
                    current++;
		}
		updateCarousel();
	}
            setTimeout(startAutoplay, 2000);
        }, { passive: true });

        // Resize handling
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                updateCarousel(false);
            }, 100);
        });

        // Initialize
        updateCarousel(false);
        startAutoplay();
    });
</script>

