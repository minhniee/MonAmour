@using MonAmour.ViewModels
@model OrderSummaryViewModel

@{
    string GetStatusColor(string status)
    {
        return status switch
        {
            "Confirmed" => "bg-blue-100 text-blue-800 border-blue-200",
            "Shipping" => "bg-yellow-100 text-yellow-800 border-yellow-200",
            "Completed" => "bg-green-100 text-green-800 border-green-200",
            "Canceled" => "bg-red-100 text-red-800 border-red-200",
            _ => "bg-gray-100 text-gray-800 border-gray-200"
        };
    }

    string GetStatusText(string status)
    {
        return status switch
        {
            "Confirmed" => "Confirmed",
            "Shipping" => "Shipping", 
            "Completed" => "Completed",
            "Canceled" => "Canceled",
            _ => status
        };
    }
}

<div class="bg-white rounded-lg border-2 mb-6 hover:shadow-lg transition-shadow duration-300" style="border-color: #fbf1e6;">
    <div class="p-6">
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-grow">
                <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2 mb-3">
                    <div>
                        <h3 class="font-prata text-lg font-semibold text-gray-900 mb-1">@Model.OrderNumber</h3>
                        <p class="text-sm text-gray-600">Ordered: @Model.OrderDate.ToString("MM/dd/yyyy")</p>
                    </div>
                    <span class="@GetStatusColor(Model.Status) font-medium px-3 py-1 rounded-full text-sm border">
                        @GetStatusText(Model.Status)
                    </span>
                </div>

                <div class="grid grid-cols-1 gap-4 text-sm">
                    <div>
                        <div class="font-medium mb-2" style="color: #62000d;">Items</div>
                        <ul class="list-disc list-inside text-gray-800">
                            @foreach (var item in Model.Items)
                            {
                                <li>
                                    <span class="font-semibold">@item.Name</span>
                                    <span class="text-gray-600">x @item.Quantity</span>
                                    <span class="float-right">@item.TotalPrice.ToString("C")</span>
                                </li>
                            }
                        </ul>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row md:justify-between md:items-center mt-4 gap-3">
                    <div class="text-lg font-semibold" style="color: #62000d;">
                        @Model.TotalAmount.ToString("C")
                    </div>

                    @if (Model.CanReview && Model.Status == "Completed")
                    {
                        <div class="w-full">
                            <div class="font-medium mb-2">Rate & Review</div>
                            @foreach (var item in Model.Items)
                            {
                                <form asp-controller="Profile" asp-action="SubmitReview" method="post" class="grid grid-cols-1 md:grid-cols-12 gap-2 items-end mb-3">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="targetId" value="@item.TargetId" />
                                    <input type="hidden" name="targetType" value="@item.ItemType" />
                                    <div class="md:col-span-3">
                                        <label class="block text-sm mb-1">Item</label>
                                        <input type="text" value="@item.Name" class="w-full p-2 border rounded" readonly />
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm mb-1">Rating</label>
                                        <select name="rating" class="w-full p-2 border rounded" required>
                                            <option value="">Select</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-5">
                                        <label class="block text-sm mb-1">Comment</label>
                                        <input type="text" name="comment" class="w-full p-2 border rounded" placeholder="Optional" />
                                    </div>
                                    <div class="md:col-span-2">
                                        <button type="submit" class="w-full px-4 py-2 text-white rounded" style="background-color: #62000d;">Submit</button>
                                    </div>
                                </form>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
